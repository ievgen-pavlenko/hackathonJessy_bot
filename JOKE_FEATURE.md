# üé≠ Joke Feature

> **–ù–∞–≤—ñ–≥–∞—Ü—ñ—è**: [README.md](README.md) ‚Üê [JOKE_FEATURE.md](JOKE_FEATURE.md) ‚Üí [API_SETUP.md](API_SETUP.md)

## –û–≥–ª—è–¥

–ö–æ–º–∞–Ω–¥–∞ `/joke` –¥–æ–¥–∞—î —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –≤–∏–ø–∞–¥–∫–æ–≤–∏—Ö –∂–∞—Ä—Ç—ñ–≤ –∑ –≤–∞—à–æ–≥–æ –≤–ª–∞—Å–Ω–æ–≥–æ HTTP API –¥–æ Telegram –±–æ—Ç–∞.

## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å

### –ö–æ–º–∞–Ω–¥–∏
- `/joke` - –û—Ç—Ä–∏–º–∞—Ç–∏ –≤–∏–ø–∞–¥–∫–æ–≤–∏–π –∂–∞—Ä—Ç –∑ –≤–∞—à–æ–≥–æ API

### –ö–Ω–æ–ø–∫–∏
- **üé≠ Joke** - –í –≥–æ–ª–æ–≤–Ω–æ–º—É –º–µ–Ω—é –¥–ª—è —à–≤–∏–¥–∫–æ–≥–æ –¥–æ—Å—Ç—É–ø—É
- **üé≠ Another Joke** - –î–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –Ω–æ–≤–æ–≥–æ –∂–∞—Ä—Ç—É
- **üîÑ Try Again** - –ü—Ä–∏ –ø–æ–º–∏–ª—Ü—ñ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è

## API

### –í–∞—à–µ HTTP API
- **URL**: –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `JOKES_API_URL`
- **Endpoint**: –ù–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è —á–µ—Ä–µ–∑ `JOKES_API_ENDPOINT` (–∑–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º `/api/getJoke`)
- **–ú–µ—Ç–æ–¥**: POST
- **Timeout**: 10 —Å–µ–∫—É–Ω–¥ (–Ω–∞–ª–∞—à—Ç–æ–≤—É—î—Ç—å—Å—è)
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è**: Bearer token (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
- **–§–æ—Ä–º–∞—Ç –∑–∞–ø–∏—Ç—É**: JSON
- **–§–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ**: JSON

### API Schema

#### –ó–∞–ø–∏—Ç (Request)
```json
{
  "input": "–†–æ–∑–∫–∞–∂–∏ –∞–Ω–µ–∫–¥–æ—Ç"
}
```

**–ü–æ–ª—è –∑–∞–ø–∏—Ç—É:**
- `input` (string, nullable) - –ë—É–¥—å-—è–∫–∏–π —Ç–µ–∫—Å—Ç–æ–≤–∏–π –≤–≤—ñ–¥. –ó–º—ñ—Å—Ç —ñ–≥–Ω–æ—Ä—É—î—Ç—å—Å—è –º–æ–¥–µ–ª–ª—é, –∞–ª–µ –ø–æ–ª–µ –æ–±–æ–≤'—è–∑–∫–æ–≤–µ.

#### –í—ñ–¥–ø–æ–≤—ñ–¥—å (Response)
```json
{
  "response": "–ß–æ–º—É –ø—Ä–æ–≥—Ä–∞–º—ñ—Å—Ç–∏ –ø–ª—É—Ç–∞—é—Ç—å –•–µ–ª–ª–æ–≤—ñ–Ω —Ç–∞ –†—ñ–∑–¥–≤–æ? –¢–æ–º—É —â–æ 31 OCT = 25 DEC."
}
```

**–ü–æ–ª—è –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ:**
- `response` (string, nullable) - –ó–≥–µ–Ω–µ—Ä–æ–≤–∞–Ω–∏–π —Ç–µ–∫—Å—Ç –∂–∞—Ä—Ç—É.

### HTTP —Å—Ç–∞—Ç—É—Å –∫–æ–¥–∏

| –ö–æ–¥ | –û–ø–∏—Å | –û–±—Ä–æ–±–∫–∞ |
|-----|------|---------|
| 200 | –£—Å–ø—ñ—Ö | ‚úÖ –í—ñ–¥–æ–±—Ä–∞–∂–∞—î—Ç—å—Å—è –∂–∞—Ä—Ç |
| 401 | –ù–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏–π | ‚ùå –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API –∫–ª—é—á |
| 403 | –ó–∞–±–æ—Ä–æ–Ω–µ–Ω–æ | ‚ùå –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É |
| 404 | –ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ | ‚ùå –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL —Ç–∞ endpoint |
| 500 | –ü–æ–º–∏–ª–∫–∞ —Å–µ—Ä–≤–µ—Ä–∞ | ‚ùå –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API |

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

| –ó–º—ñ–Ω–Ω–∞ | –û–ø–∏—Å | –û–±–æ–≤'—è–∑–∫–æ–≤–∞ | –ó–∞ –∑–∞–º–æ–≤—á—É–≤–∞–Ω–Ω—è–º |
|--------|------|-------------|------------------|
| `JOKES_API_URL` | –ë–∞–∑–æ–≤–∏–π URL –≤–∞—à–æ–≥–æ API | ‚úÖ | - |
| `JOKES_API_ENDPOINT` | Endpoint –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∂–∞—Ä—Ç—ñ–≤ | ‚ùå | `/api/getJoke` |
| `JOKES_API_TIMEOUT` | –¢–∞–π–º–∞—É—Ç –∑–∞–ø–∏—Ç—É (—Å–µ–∫—É–Ω–¥–∏) | ‚ùå | `10` |
| `JOKES_API_KEY` | API –∫–ª—é—á –¥–ª—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—ó | ‚ùå | - |

### –ü—Ä–∏–∫–ª–∞–¥ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

```bash
# config.env
JOKES_API_URL=https://your-api-domain.com
JOKES_API_ENDPOINT=/api/getJoke
JOKES_API_TIMEOUT=15
JOKES_API_KEY=your_api_key_here
```

### Docker –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

```bash
# –ó–∞–ø—É—Å–∫ –∑ –≤–∞—à–∏–º API
docker run -d \
  --name telegram-bot \
  -e BOT_TOKEN="YOUR_BOT_TOKEN" \
  -e JOKES_API_URL="https://your-api-domain.com" \
  -e JOKES_API_ENDPOINT="/api/getJoke" \
  -e JOKES_API_KEY="your_api_key" \
  -e JOKES_API_TIMEOUT=15 \
  telegram-bot
```

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –ú–æ–¥—É–ª—ñ

#### `utils.py`
- `fetch_joke()` - –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∂–∞—Ä—Ç—É –∑ API
- `format_joke()` - –§–æ—Ä–º–∞—Ç—É–≤–∞–Ω–Ω—è –∂–∞—Ä—Ç—É –¥–ª—è –≤—ñ–¥–æ–±—Ä–∞–∂–µ–Ω–Ω—è
- `get_random_joke()` - –ì–æ–ª–æ–≤–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è –¥–ª—è –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∂–∞—Ä—Ç—É

#### `handlers/command_handlers.py`
- `joke_command()` - –û–±—Ä–æ–±–Ω–∏–∫ –∫–æ–º–∞–Ω–¥–∏ `/joke`

#### `handlers/callback_handlers.py`
- `handle_joke_callback()` - –û–±—Ä–æ–±–Ω–∏–∫ –∫–Ω–æ–ø–∫–∏ –∂–∞—Ä—Ç—É
- –î–æ–¥–∞–Ω–∞ –∫–Ω–æ–ø–∫–∞ "üé≠ Joke" –≤ –≥–æ–ª–æ–≤–Ω–µ –º–µ–Ω—é

#### `config.py`
- `JOKES_API_URL` - URL API
- `JOKES_API_TIMEOUT` - –¢–∞–π–º–∞—É—Ç
- `JOKES_API_KEY` - API –∫–ª—é—á

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –õ–æ–∫–∞–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫

```bash
# 1. –í—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—è –∑–∞–ª–µ–∂–Ω–æ—Å—Ç–µ–π
pip install -r requirements.txt

# 2. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è (–æ–ø—Ü—ñ–æ–Ω–∞–ª—å–Ω–æ)
export JOKES_API_URL="https://your-jokes-api.com/random"
export JOKES_API_TIMEOUT=15

# 3. –ó–∞–ø—É—Å–∫
python main.py
```

### Docker

```bash
# –ó–∞–ø—É—Å–∫ –∑ –Ω–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è–º–∏
docker run -d \
  --name telegram-bot \
  -e BOT_TOKEN="YOUR_BOT_TOKEN" \
  -e JOKES_API_URL="https://your-jokes-api.com/random" \
  -e JOKES_API_TIMEOUT=15 \
  telegram-bot
```

## –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

### –¢–∏–ø–∏ –ø–æ–º–∏–ª–æ–∫

1. **Timeout** - API –Ω–µ –≤—ñ–¥–ø–æ–≤—ñ–¥–∞—î –≤—á–∞—Å–Ω–æ
2. **Connection Error** - –ü—Ä–æ–±–ª–µ–º–∏ –∑ –º–µ—Ä–µ–∂–µ—é
3. **Invalid Response** - –ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ
4. **API Error** - –ü–æ–º–∏–ª–∫–∞ API (4xx, 5xx)

### –û–±—Ä–æ–±–∫–∞ –ø–æ–º–∏–ª–æ–∫

```python
try:
    joke_data = await fetch_joke()
    if joke_data:
        formatted_joke = format_joke(joke_data)
    else:
        # Fallback message
        formatted_joke = "üòÖ Sorry, I couldn't fetch a joke right now. Try again later!"
except Exception as e:
    logger.error(f"Error fetching joke: {e}")
    # Error handling
```

## –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

### –¢–µ—Å—Ç–æ–≤–∏–π —Å–∫—Ä–∏–ø—Ç

```bash
# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç—ñ–≤
python test_joke.py
```

### –¢–µ—Å—Ç–æ–≤–∏–π –ø—Ä–∏–∫–ª–∞–¥

```python
import asyncio
from utils import get_random_joke

async def test():
    joke = await get_random_joke()
    print(joke)

asyncio.run(test())
```

## –õ–æ–≥—É–≤–∞–Ω–Ω—è

### –†—ñ–≤–Ω—ñ –ª–æ–≥—É–≤–∞–Ω–Ω—è

- **INFO**: –£—Å–ø—ñ—à–Ω–µ –æ—Ç—Ä–∏–º–∞–Ω–Ω—è –∂–∞—Ä—Ç—É
- **WARNING**: API –ø–æ–≤–µ—Ä–Ω—É–≤ –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω–∏–π —Å—Ç–∞—Ç—É—Å
- **ERROR**: –ü–æ–º–∏–ª–∫–∏ –º–µ—Ä–µ–∂—ñ, —Ç–∞–π–º–∞—É—Ç–∏, –Ω–µ–æ—á—ñ–∫—É–≤–∞–Ω—ñ –ø–æ–º–∏–ª–∫–∏

### –ü—Ä–∏–∫–ª–∞–¥ –ª–æ–≥—ñ–≤

```
2024-01-15 10:30:15 - utils - INFO - Successfully fetched joke from custom API: 123
2024-01-15 10:30:20 - utils - ERROR - Jokes API request timed out
2024-01-15 10:30:25 - utils - WARNING - Jokes API returned status 500
```

## –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö API

1. –û–Ω–æ–≤—ñ—Ç—å `JOKES_API_URL` –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
2. –ê–¥–∞–ø—Ç—É–π—Ç–µ `format_joke()` –¥–ª—è –Ω–æ–≤–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç—É
3. –î–æ–¥–∞–π—Ç–µ –æ–±—Ä–æ–±–∫—É —Å–ø–µ—Ü–∏—Ñ—ñ—á–Ω–∏—Ö –ø–æ–º–∏–ª–æ–∫

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–µ—à—É–≤–∞–Ω–Ω—è

```python
import redis
from functools import lru_cache

@lru_cache(maxsize=100)
async def get_cached_joke():
    return await fetch_joke()
```

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –∫–∞—Ç–µ–≥–æ—Ä—ñ–π –∂–∞—Ä—Ç—ñ–≤

```python
async def get_joke_by_category(category: str):
    url = f"{Config.JOKES_API_URL}?category={category}"
    # Implementation
```

## –ë–µ–∑–ø–µ–∫–∞

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü—ñ—ó

1. **API –∫–ª—é—á—ñ**: –ó–±–µ—Ä—ñ–≥–∞–π—Ç–µ –≤ –∑–º—ñ–Ω–Ω–∏—Ö —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
2. **–¢–∞–π–º–∞—É—Ç–∏**: –í—Å—Ç–∞–Ω–æ–≤–ª—é–π—Ç–µ —Ä–æ–∑—É–º–Ω—ñ —Ç–∞–π–º–∞—É—Ç–∏
3. **–í–∞–ª—ñ–¥–∞—Ü—ñ—è**: –ü–µ—Ä–µ–≤—ñ—Ä—è–π—Ç–µ –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API
4. **–õ–æ–≥—É–≤–∞–Ω–Ω—è**: –ù–µ –ª–æ–≥—É–π—Ç–µ —á—É—Ç–ª–∏–≤—ñ –¥–∞–Ω—ñ

### –ü—Ä–∏–∫–ª–∞–¥ –±–µ–∑–ø–µ—á–Ω–æ—ó –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

```bash
# –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
export JOKES_API_KEY="your_api_key"

# Docker run
docker run -d \
  --name telegram-bot \
  -e BOT_TOKEN="YOUR_BOT_TOKEN" \
  -e JOKES_API_KEY="your_api_key" \
  telegram-bot
```

## –ú–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥

### –ú–µ—Ç—Ä–∏–∫–∏

- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –∑–∞–ø–∏—Ç—ñ–≤ –¥–æ API
- –ß–∞—Å –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ API
- –ö—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–º–∏–ª–æ–∫
- –ü–æ–ø—É–ª—è—Ä–Ω—ñ—Å—Ç—å –∫–æ–º–∞–Ω–¥–∏ `/joke`

### Health Check

```python
async def health_check():
    try:
        joke = await fetch_joke()
        return joke is not None
    except:
        return False
```

## Troubleshooting

### –ß–∞—Å—Ç—ñ –ø—Ä–æ–±–ª–µ–º–∏

1. **API –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∏–π**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ URL
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –º–µ—Ä–µ–∂–µ–≤–µ –∑'—î–¥–Ω–∞–Ω–Ω—è
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Ç–∞–π–º–∞—É—Ç

2. **–ù–µ–≤—ñ—Ä–Ω–∏–π —Ñ–æ—Ä–º–∞—Ç –≤—ñ–¥–ø–æ–≤—ñ–¥—ñ**
   - –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ API –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—é
   - –û–Ω–æ–≤—ñ—Ç—å `format_joke()`

3. **–ü–æ–≤—ñ–ª—å–Ω–∞ —Ä–æ–±–æ—Ç–∞**
   - –ó–º–µ–Ω—à—ñ—Ç—å —Ç–∞–π–º–∞—É—Ç
   - –î–æ–¥–∞–π—Ç–µ –∫–µ—à—É–≤–∞–Ω–Ω—è
   - –í–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–π—Ç–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ñ –∑–∞–ø–∏—Ç–∏

### –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ API
curl https://your-api-domain.com/api/jokes/random

# –¢–µ—Å—Ç —Ñ—É–Ω–∫—Ü—ñ–π
python test_joke.py

# –õ–æ–≥–∏
docker logs telegram-bot | grep joke
```

## –ü–æ—Å–∏–ª–∞–Ω–Ω—è

- **–®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç**: [QUICK_START.md](QUICK_START.md)
- **–ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è API**: [API_SETUP.md](API_SETUP.md)
- **–ì–æ–ª–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è**: [README.md](README.md)

---

**Joke —Ñ—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª –≥–æ—Ç–æ–≤–∏–π –¥–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è! üéâ**