# üìä Statistics Feature

> **–ù–∞–≤—ñ–≥–∞—Ü—ñ—è**: [README.md](README.md) ‚Üê [QUICK_START.md](QUICK_START.md)

## –û–≥–ª—è–¥

–°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –¥–æ–∑–≤–æ–ª—è—î –≤—ñ–¥—Å—Ç–µ–∂—É–≤–∞—Ç–∏ –∞–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤, –∞–Ω–∞–ª—ñ–∑—É–≤–∞—Ç–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è –±–æ—Ç–∞ —Ç–∞ –Ω–∞–¥–∞–≤–∞—Ç–∏ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º –¥–µ—Ç–∞–ª—å–Ω—É —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—é –ø—Ä–æ —Ä–æ–±–æ—Ç—É –±–æ—Ç–∞.

## –§—É–Ω–∫—Ü—ñ–æ–Ω–∞–ª—å–Ω—ñ—Å—Ç—å

### üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞
- **–ß–∞—Å —Ä–æ–±–æ—Ç–∏** - —Å–∫—ñ–ª—å–∫–∏ —á–∞—Å—É –±–æ—Ç –ø—Ä–∞—Ü—é—î –±–µ–∑ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
- **–û—Å—Ç–∞–Ω–Ω—ñ–π –∑–∞–ø—É—Å–∫** - –∫–æ–ª–∏ –±–æ—Ç –±—É–≤ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä–∞–∑ –ø–µ—Ä–µ–∑–∞–ø—É—â–µ–Ω–∏–π
- **–ö—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** - –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å —É–Ω—ñ–∫–∞–ª—å–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- **–ê–∫—Ç–∏–≤–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ** - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤ –∑–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 24 –≥–æ–¥–∏–Ω–∏
- **–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è** - –∑–∞–≥–∞–ª—å–Ω–∞ –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ç–∞ –∫–æ–º–∞–Ω–¥
- **–¢–æ–ø –∫–æ–º–∞–Ω–¥** - –Ω–∞–π–ø–æ–ø—É–ª—è—Ä–Ω—ñ—à—ñ –∫–æ–º–∞–Ω–¥–∏

### üë• –í—ñ–¥—Å—Ç–µ–∂–µ–Ω–Ω—è –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- **–£–Ω—ñ–∫–∞–ª—å–Ω—ñ ID** - –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è ID –≤—Å—ñ—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- **–ü—Ä–æ—Ñ—ñ–ª—å –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞** - username, —ñ–º'—è, –ø—Ä—ñ–∑–≤–∏—â–µ
- **–ê–∫—Ç–∏–≤–Ω—ñ—Å—Ç—å** - –∫–æ–ª–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –≤–ø–µ—Ä—à–µ —Ç–∞ –æ—Å—Ç–∞–Ω–Ω—ñ–π —Ä–∞–∑ –ø–∏—Å–∞–≤
- **–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è** - –∫—ñ–ª—å–∫—ñ—Å—Ç—å –ø–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å —Ç–∞ –∫–æ–º–∞–Ω–¥
- **–Ü—Å—Ç–æ—Ä—ñ—è –∫–æ–º–∞–Ω–¥** - —è–∫—ñ –∫–æ–º–∞–Ω–¥–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞–≤ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á

### üîê –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∏–π –ø–∞–Ω–µ–ª—å
- **–°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤** - –≤—Å—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ –∑ –¥–µ—Ç–∞–ª—å–Ω–æ—é —ñ–Ω—Ñ–æ—Ä–º–∞—Ü—ñ—î—é
- **–ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è** - –¥–æ—Å—Ç—É–ø —Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
- **–†–µ–∞–ª—å–Ω–∏–π —á–∞—Å** - –æ–Ω–æ–≤–ª–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º—É —á–∞—Å—ñ
- **–ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö** - –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –≤ JSON —Ñ–æ—Ä–º–∞—Ç—ñ

## –ö–æ–º–∞–Ω–¥–∏

### `/stats`
–ü–æ–∫–∞–∑—É—î –¥–µ—Ç–∞–ª—å–Ω—É —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É –±–æ—Ç–∞:
```
üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞

üïê –û—Å—Ç–∞–Ω–Ω—ñ–π –∑–∞–ø—É—Å–∫: 27.09.2025 20:30:15 UTC
‚è±Ô∏è –ß–∞—Å —Ä–æ–±–æ—Ç–∏: 2–≥ 15—Ö–≤

üë• –ö–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ:
‚Ä¢ –í—Å—å–æ–≥–æ: 25
‚Ä¢ –ó–∞ –æ—Å—Ç–∞–Ω–Ω—ñ 24 –≥–æ–¥: 8

üì® –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è:
‚Ä¢ –í—Å—å–æ–≥–æ: 156
‚Ä¢ –ö–æ–º–∞–Ω–¥: 89

üî• –¢–æ–ø –∫–æ–º–∞–Ω–¥:
‚Ä¢ /start: 25
‚Ä¢ /joke: 18
‚Ä¢ /menu: 15
‚Ä¢ /help: 12
‚Ä¢ /info: 8
```

### `/admin`
–ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–∏–≤–Ω–∞ –ø–∞–Ω–µ–ª—å (—Ç—ñ–ª—å–∫–∏ –¥–ª—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤):
```
üë• –°–ø–∏—Å–æ–∫ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤:

1. **John Doe** (@johndoe)
   ID: `123456789` | –û—Å—Ç–∞–Ω–Ω—ñ–π –≤—ñ–∑–∏—Ç: 27.09 20:25
   –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: 15

2. **Jane Smith** (@janesmith)
   ID: `987654321` | –û—Å—Ç–∞–Ω–Ω—ñ–π –≤—ñ–∑–∏—Ç: 27.09 19:45
   –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: 8

3. **User** (@unknown)
   ID: `555666777` | –û—Å—Ç–∞–Ω–Ω—ñ–π –≤—ñ–∑–∏—Ç: 27.09 18:30
   –ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω—å: 3

... —Ç–∞ —â–µ 22 –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
```

## –ö–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—è

### –ó–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞

| –ó–º—ñ–Ω–Ω–∞ | –û–ø–∏—Å | –ü—Ä–∏–∫–ª–∞–¥ |
|--------|------|---------|
| `ADMIN_USER_IDS` | ID –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ (—á–µ—Ä–µ–∑ –∫–æ–º—É) | `123456789,987654321` |
| `STATS_DATA_DIR` | –ü–∞–ø–∫–∞ –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –¥–∞–Ω–∏—Ö | `data` |

### –ü—Ä–∏–∫–ª–∞–¥ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó

```bash
# .env —Ñ–∞–π–ª
ADMIN_USER_IDS=123456789,987654321
STATS_DATA_DIR=data
```

## –ê—Ä—Ö—ñ—Ç–µ–∫—Ç—É—Ä–∞

### –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–∏—Ö

#### UserStats
```python
@dataclass
class UserStats:
    user_id: int
    username: Optional[str]
    first_name: Optional[str]
    last_name: Optional[str]
    first_seen: str
    last_seen: str
    message_count: int
    commands_used: Dict[str, int]
```

#### BotStats
```python
@dataclass
class BotStats:
    start_time: str
    last_restart: str
    total_users: int
    total_messages: int
    total_commands: int
    commands_breakdown: Dict[str, int]
```

### –ó–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö

#### JSON —Ñ–∞–π–ª–∏
- **`data/users.json`** - –¥–∞–Ω—ñ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- **`data/bot_stats.json`** - —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –±–æ—Ç–∞

#### –§–æ—Ä–º–∞—Ç –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
```json
{
  "123456789": {
    "user_id": 123456789,
    "username": "johndoe",
    "first_name": "John",
    "last_name": "Doe",
    "first_seen": "2025-09-27T18:15:30+00:00",
    "last_seen": "2025-09-27T20:25:45+00:00",
    "message_count": 15,
    "commands_used": {
      "/start": 1,
      "/joke": 5,
      "/menu": 3
    }
  }
}
```

## –ë–µ–∑–ø–µ–∫–∞

### –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü—ñ—è –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤
- –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ User ID –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ `/admin`
- –°–ø–∏—Å–æ–∫ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä—ñ–≤ –≤ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
- –í—ñ–¥–º–æ–≤–∞ –≤ –¥–æ—Å—Ç—É–ø—ñ –¥–ª—è –Ω–µ–∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω–∏—Ö –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤

### –ó–∞—Ö–∏—Å—Ç –¥–∞–Ω–∏—Ö
- –õ–æ–∫–∞–ª—å–Ω–µ –∑–±–µ—Ä—ñ–≥–∞–Ω–Ω—è –¥–∞–Ω–∏—Ö
- –®–∏—Ñ—Ä—É–≤–∞–Ω–Ω—è –Ω–µ –≤–∏–º–∞–≥–∞—î—Ç—å—Å—è (–ø—É–±–ª—ñ—á–Ω—ñ –¥–∞–Ω—ñ)
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–µ —Ä–µ–∑–µ—Ä–≤–Ω–µ –∫–æ–ø—ñ—é–≤–∞–Ω–Ω—è

## –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è

### –õ–æ–∫–∞–ª—å–Ω–∏–π –∑–∞–ø—É—Å–∫
```bash
# 1. –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è
export ADMIN_USER_IDS="123456789,987654321"
export STATS_DATA_DIR="data"

# 2. –ó–∞–ø—É—Å–∫
python main.py
```

### Docker
```bash
# –ó–∞–ø—É—Å–∫ –∑ –∞–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä–∞–º–∏
docker run -d \
  --name telegram-bot \
  -e BOT_TOKEN="YOUR_BOT_TOKEN" \
  -e ADMIN_USER_IDS="123456789,987654321" \
  -e STATS_DATA_DIR="data" \
  -v $(pwd)/data:/app/data \
  telegram-bot
```

### Docker Compose
```yaml
services:
  telegram-bot:
    build: .
    environment:
      - BOT_TOKEN=${BOT_TOKEN}
      - ADMIN_USER_IDS=123456789,987654321
      - STATS_DATA_DIR=data
    volumes:
      - ./data:/app/data
    restart: unless-stopped
```

## –î—ñ–∞–≥–Ω–æ—Å—Ç–∏–∫–∞

### –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ñ–∞–π–ª—ñ–≤ –¥–∞–Ω–∏—Ö
ls -la data/
cat data/users.json | jq
cat data/bot_stats.json | jq

# –õ–æ–≥–∏
docker logs telegram-bot | grep "User interaction tracked"
docker logs telegram-bot | grep "Command usage tracked"
```

### –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è
```python
# –¢–µ—Å—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
from stats import stats_manager

# –û—Ç—Ä–∏–º–∞—Ç–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
stats = stats_manager.get_bot_stats()
print(f"Total users: {stats.total_users}")

# –û—Ç—Ä–∏–º–∞—Ç–∏ –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
users = stats_manager.get_all_users()
for user in users[:5]:
    print(f"User: {user.first_name} (@{user.username})")
```

## –†–æ–∑—à–∏—Ä–µ–Ω–Ω—è

### –î–æ–¥–∞–≤–∞–Ω–Ω—è –Ω–æ–≤–∏—Ö –º–µ—Ç—Ä–∏–∫
```python
# –í stats.py
def track_custom_metric(self, user_id: int, metric: str, value: int):
    """Track custom metric for user"""
    if user_id in self.users:
        if metric not in self.users[user_id].custom_metrics:
            self.users[user_id].custom_metrics[metric] = 0
        self.users[user_id].custom_metrics[metric] += value
```

### –ï–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–∏—Ö
```python
# –ï–∫—Å–ø–æ—Ä—Ç –≤ CSV
import csv

def export_users_csv(self, filename: str):
    """Export users to CSV file"""
    with open(filename, 'w', newline='', encoding='utf-8') as f:
        writer = csv.writer(f)
        writer.writerow(['User ID', 'Username', 'First Name', 'Last Name', 'Messages', 'Last Seen'])
        for user in self.users.values():
            writer.writerow([
                user.user_id, user.username, user.first_name, 
                user.last_name, user.message_count, user.last_seen
            ])
```

## Troubleshooting

### –ü—Ä–æ–±–ª–µ–º–∞: –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—î—Ç—å—Å—è
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø—É
ls -la data/
chmod 755 data/
chown -R 1000:1000 data/
```

### –ü—Ä–æ–±–ª–µ–º–∞: –ê–¥–º—ñ–Ω—ñ—Å—Ç—Ä–∞—Ç–æ—Ä –Ω–µ –º–æ–∂–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ /admin
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –∫–æ–Ω—Ñ—ñ–≥—É—Ä–∞—Ü—ñ—ó
echo $ADMIN_USER_IDS
docker exec telegram-bot printenv ADMIN_USER_IDS
```

### –ü—Ä–æ–±–ª–µ–º–∞: –î–∞–Ω—ñ –≤—Ç—Ä–∞—á–∞—é—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫—É
```bash
# –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –º–æ–Ω—Ç—É–≤–∞–Ω–Ω—è —Ç–æ–º—ñ–≤
docker inspect telegram-bot | grep Mounts
```

## –ù–∞–≤—ñ–≥–∞—Ü—ñ—è

- [README.md](README.md) - –ì–æ–ª–æ–≤–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü—ñ—è
- [QUICK_START.md](QUICK_START.md) - –®–≤–∏–¥–∫–∏–π —Å—Ç–∞—Ä—Ç
- [JOKE_FEATURE.md](JOKE_FEATURE.md) - –§—É–Ω–∫—Ü—ñ—è –∂–∞—Ä—Ç—ñ–≤
- [API_SETUP.md](API_SETUP.md) - –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è API
